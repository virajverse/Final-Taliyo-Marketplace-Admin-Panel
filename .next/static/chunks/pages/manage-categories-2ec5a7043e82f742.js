(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[753],{8092:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-categories",function(){return t(720)}])},720:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var a=t(5893),r=t(7294),l=t(6880),i=t(4270),c=t(8655),n=t(2190),d=t(3050),o=t(6127),u=t(1134);let m=(0,u.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),x=(0,u.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var g=t(3832),h=t(5928),y=t(4442),j=t(7864),f=t(5237),p=t(6259),v=e=>{let{user:s}=e,[t,u]=(0,r.useState)([]),[v,b]=(0,r.useState)([]),[N,w]=(0,r.useState)(!0),[_,C]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),[z,O]=(0,r.useState)(!1),[Z,E]=(0,r.useState)(null),[q,D]=(0,r.useState)(null),[A,I]=(0,r.useState)(""),[F,L]=(0,r.useState)(new Set),[T,P]=(0,r.useState)(""),[U,X]=(0,r.useState)(""),[M,R]=(0,r.useState)({name:"",description:"",icon:"",slug:"",sort_order:0}),[B,G]=(0,r.useState)({category_id:"",name:"",slug:""});(0,r.useEffect)(()=>{s&&(H(),J())},[s]);let H=async()=>{try{let{data:e,error:s}=await p.O.from("categories").select("*").order("sort_order",{ascending:!0});if(s)throw s;u(e||[])}catch(e){console.error("Error loading categories:",e),P("Failed to load categories")}},J=async()=>{try{let{data:e,error:s}=await p.O.from("subcategories").select("\n          *,\n          categories (name)\n        ").order("name",{ascending:!0});if(s)throw s;b(e||[])}catch(e){console.error("Error loading subcategories:",e),P("Failed to load subcategories")}finally{w(!1)}},K=e=>e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").trim(),Q=async e=>{e.preventDefault(),P(""),X("");try{let e={...M,slug:M.slug||K(M.name),sort_order:parseInt(M.sort_order)||0,updated_at:new Date().toISOString()};if(Z){let{error:s}=await p.O.from("categories").update(e).eq("id",Z.id);if(s)throw s;u(t.map(s=>s.id===Z.id?{...s,...e}:s)),X("Category updated successfully")}else{e.created_at=new Date().toISOString();let{data:s,error:a}=await p.O.from("categories").insert([e]).select().single();if(a)throw a;u([...t,s]),X("Category created successfully")}R({name:"",description:"",icon:"",slug:"",sort_order:0}),k(!1),E(null)}catch(e){console.error("Error saving category:",e),P("Failed to save category: "+e.message)}},V=async e=>{e.preventDefault(),P(""),X("");try{let e={...B,slug:B.slug||K(B.name),created_at:new Date().toISOString()};if(q){let{error:s}=await p.O.from("subcategories").update(e).eq("id",q.id);if(s)throw s;J(),X("Subcategory updated successfully")}else{let{data:s,error:t}=await p.O.from("subcategories").insert([e]).select().single();if(t)throw t;J(),X("Subcategory created successfully")}G({category_id:"",name:"",slug:""}),O(!1),D(null)}catch(e){console.error("Error saving subcategory:",e),P("Failed to save subcategory: "+e.message)}},W=e=>{R({name:e.name,description:e.description||"",icon:e.icon||"",slug:e.slug,sort_order:e.sort_order||0}),E(e),k(!0)},Y=e=>{G({category_id:e.category_id,name:e.name,slug:e.slug}),D(e),O(!0)},$=async e=>{if(confirm("Are you sure you want to delete this category? This will also delete all its subcategories and may affect services."))try{let{error:s}=await p.O.from("categories").delete().eq("id",e);if(s)throw s;u(t.filter(s=>s.id!==e)),b(v.filter(s=>s.category_id!==e)),X("Category deleted successfully")}catch(e){console.error("Error deleting category:",e),P("Failed to delete category: "+e.message)}},ee=async e=>{if(confirm("Are you sure you want to delete this subcategory?"))try{let{error:s}=await p.O.from("subcategories").delete().eq("id",e);if(s)throw s;b(v.filter(s=>s.id!==e)),X("Subcategory deleted successfully")}catch(e){console.error("Error deleting subcategory:",e),P("Failed to delete subcategory: "+e.message)}},es=async(e,s)=>{try{let{error:a}=await p.O.from("categories").update({is_active:!s,updated_at:new Date().toISOString()}).eq("id",e);if(a)throw a;u(t.map(t=>t.id===e?{...t,is_active:!s}:t)),X("Category ".concat(s?"deactivated":"activated"," successfully"))}catch(e){console.error("Error updating category status:",e),P("Failed to update category status")}},et=async(e,s)=>{try{let{error:t}=await p.O.from("subcategories").update({is_active:!s}).eq("id",e);if(t)throw t;b(v.map(t=>t.id===e?{...t,is_active:!s}:t)),X("Subcategory ".concat(s?"deactivated":"activated"," successfully"))}catch(e){console.error("Error updating subcategory status:",e),P("Failed to update subcategory status")}},ea=e=>{let s=new Set(F);s.has(e)?s.delete(e):s.add(e),L(s)},er=t.filter(e=>{var s;return e.name.toLowerCase().includes(_.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(_.toLowerCase()))}),el=e=>v.filter(s=>s.category_id===e);return s?(0,a.jsx)(l.Z,{user:s,children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage Categories"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Organize your services with categories and subcategories."})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>{O(!0),D(null),G({category_id:"",name:"",slug:""})},className:"btn-secondary flex items-center",children:[(0,a.jsx)(i.Z,{size:16,className:"mr-2"}),"Add Subcategory"]}),(0,a.jsxs)("button",{onClick:()=>{k(!0),E(null),R({name:"",description:"",icon:"",slug:"",sort_order:0})},className:"btn-primary flex items-center",children:[(0,a.jsx)(i.Z,{size:16,className:"mr-2"}),"Add Category"]})]})]}),T&&(0,a.jsx)("div",{className:"alert-error",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.Z,{size:20,className:"mr-2 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:T}),(0,a.jsx)("button",{onClick:()=>P(""),className:"ml-auto",children:(0,a.jsx)(n.Z,{size:16})})]})}),U&&(0,a.jsx)("div",{className:"alert-success",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(d.Z,{size:20,className:"mr-2 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:U}),(0,a.jsx)("button",{onClick:()=>X(""),className:"ml-auto",children:(0,a.jsx)(n.Z,{size:16})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search categories...",value:_,onChange:e=>C(e.target.value),className:"form-input pl-10"})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Categories (",er.length,")"]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:N?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading categories..."})]}):er.length>0?er.map(e=>{let s=el(e.id),t=F.has(e.id);return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,a.jsx)("button",{onClick:()=>ea(e.id),className:"text-gray-400 hover:text-gray-600",children:t?(0,a.jsx)(m,{size:20}):(0,a.jsx)(x,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.name}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[s.length," subcategories"]})]}),e.description&&(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:["Slug: ",e.slug]}),(0,a.jsxs)("span",{children:["Order: ",e.sort_order]}),e.icon&&(0,a.jsxs)("span",{children:["Icon: ",e.icon]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>es(e.id,e.is_active),className:"text-blue-600 hover:text-blue-800",title:e.is_active?"Deactivate":"Activate",children:e.is_active?(0,a.jsx)(g.Z,{size:16}):(0,a.jsx)(h.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>W(e),className:"text-green-600 hover:text-green-800",title:"Edit",children:(0,a.jsx)(y.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>$(e.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:(0,a.jsx)(j.Z,{size:16})})]})]}),t&&s.length>0&&(0,a.jsx)("div",{className:"mt-4 ml-8 space-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Slug: ",e.slug]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>et(e.id,e.is_active),className:"text-blue-600 hover:text-blue-800",title:e.is_active?"Deactivate":"Activate",children:e.is_active?(0,a.jsx)(g.Z,{size:14}):(0,a.jsx)(h.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>Y(e),className:"text-green-600 hover:text-green-800",title:"Edit",children:(0,a.jsx)(y.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>ee(e.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:(0,a.jsx)(j.Z,{size:14})})]})]},e.id))})]},e.id)}):(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)(f.Z,{size:48,className:"mx-auto text-gray-300 mb-3"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No categories found"})]})})]}),S&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:Z?"Edit Category":"Add New Category"}),(0,a.jsxs)("form",{onSubmit:Q,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Name *"}),(0,a.jsx)("input",{type:"text",value:M.name,onChange:e=>{let s=e.target.value;R({...M,name:s,slug:M.slug||K(s)})},className:"form-input",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Slug *"}),(0,a.jsx)("input",{type:"text",value:M.slug,onChange:e=>R({...M,slug:e.target.value}),className:"form-input",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Description"}),(0,a.jsx)("textarea",{value:M.description,onChange:e=>R({...M,description:e.target.value}),className:"form-input",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Icon"}),(0,a.jsx)("input",{type:"text",value:M.icon,onChange:e=>R({...M,icon:e.target.value}),className:"form-input",placeholder:"e.g., web, design, marketing"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Sort Order"}),(0,a.jsx)("input",{type:"number",value:M.sort_order,onChange:e=>R({...M,sort_order:e.target.value}),className:"form-input",min:"0"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{k(!1),E(null)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:Z?"Update Category":"Create Category"})]})]})]})})}),z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg w-full max-w-xl max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:q?"Edit Subcategory":"Add New Subcategory"}),(0,a.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Category *"}),(0,a.jsxs)("select",{value:B.category_id,onChange:e=>G({...B,category_id:e.target.value}),className:"form-input",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a category"}),t.filter(e=>e.is_active).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Name *"}),(0,a.jsx)("input",{type:"text",value:B.name,onChange:e=>{let s=e.target.value;G({...B,name:s,slug:B.slug||K(s)})},className:"form-input",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Slug *"}),(0,a.jsx)("input",{type:"text",value:B.slug,onChange:e=>G({...B,slug:e.target.value}),className:"form-input",required:!0})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{O(!1),D(null)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:q?"Update Subcategory":"Create Subcategory"})]})]})]})})})]})}):null}}},function(e){e.O(0,[941,736,982,888,774,179],function(){return e(e.s=8092)}),_N_E=e.O()}]);